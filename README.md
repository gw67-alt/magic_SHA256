TODO: verify source code, fix potential bugs on actual hardware
